{% extends 'leruimoveis/normal_base.html' %}

{% load static %}  

{% block content %} 


<div class="container marketing px-4 py-5 mb-3">
    <div class="section">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-5 mb-lg-0" data-aos="fade-up" data-aos-delay="100" >
                    <div class="d-grid gap-2">
                        <button class="btn btn-secondary btn-sm btn-registase btn-open-table" type="button" onclick="openTable()" id="btnOpenTable">Meus Anúncios</button>
                        <button class="btn btn-secondary btn-sm btn-registase btn-open-mobile" type="button" onclick="openMobile()" id="btnOpenMobile">Meus Anúncios</button>
                        <a href="{% url 'fotos_adicionais' %}" class="btn btn-secondary btn-sm btn-registase" type="button">Fotos Adicionais</a>
                        <a href="{% url 'info_adicionais' %}" class="btn btn-secondary btn-sm btn-registase">Informações Adicionais</a>
                    </div>
                </div>
                <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">

                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show mt-2" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    {% if form.errors %}
                        <div class="alert alert-danger mt-2"> {{ form.errors }} </div>
                    {% endif %}

                    <div class="form-imovel" id="formImovel" style="display: none;">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}

                            <input type="hidden" id="property_id" name="property_id">

                            <div class="row">
                                <div class="col-12 mb-0">
                                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                                        <div><div class="container justify-content-center text-center">NOVO ANÚNCIO </div> </div>
                                    </div>
                                </div>
                                <div class="col-12 mb-3">
                                    <input type="text" name="titulo" class="form-control" placeholder="Titulo" required/>
                                </div>
                                <div class="col-12 mb-3" style="margin-bottom: 0px !important;">
                                    <select name="designacao" class="form-select form-select-lg mb-3 form-control" aria-label=".form-select-lg example" style="padding: 6px 2px 6px 12px; font-size: 16px;color: #777676;">
                                        <option selected>Designação</option>
                                        <option value="1">Vende-se</option>
                                        <option value="2">Arrenda-se</option>
                                        <option value="3">Traspassa-se</option>
                                    </select>
                                </div>
                                <div class="col-12 mb-3">
                                    <textarea name="endereco" class="form-control" placeholder="Endereço" id="floatingTextarea2" style="height: 150px" required></textarea>
                                </div>
                                <div class="col-12 mb-3">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="pais" value="1" checked>
                                        <label class="form-check-label" for="inlineCheckbox1">Portugal</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="pais" value="2">
                                        <label class="form-check-label" for="inlineCheckbox2">Angola</label>
                                    </div>
                                </div>
                                <div class="col-12 mb-3" style="margin-bottom: 0px !important;">
                                    <select name="cidade" class="form-select form-select-lg mb-3 form-control" aria-label=".form-select-lg example" style="padding: 6px 2px 6px 12px; font-size: 16px;color: #777676;">
                                        <option value="">Selecione a cidade</option>
                                        {% for cidade in cidades %}
                                            <option value="{{ cidade.cidade_id }}" data-pais="{{ cidade.pais_id }}">
                                                {{ cidade.nome }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-12 mb-3">
                                    <input id="preco" name="preco" type="text" class="form-control" placeholder="Preço" />
                                </div>
                                <div class="col-12 mb-3">
                                    <div class="input-group mb-3">
                                        <input type="file" name="fotos" class="form-control" id="inputGroupFile02" style="height: 38px; padding-left: 11px;">
                                        <label class="input-group-text" for="inputGroupFile02">Foto</label>
                                        <img id="preview-foto" src="" alt="Imagem atual" class="img-fluid mt-2 rounded shadow">
                                    </div>
                                </div>
                                <div class="col-12 mb-3">
                                    <textarea name="descricao" class="form-control" placeholder="Descrição" id="floatingTextarea2" style="height: 150px"></textarea>
                                </div>
                                <div class="col-12">
                                    <input type="submit" value="Guardar" class="btn btn-detalhes" />
                                </div>
                            </div>
                        </form>
                    </div>
                
                    <div class="tabela-detalhes" id="caixa-detalhes">
                        <div class="col-12 mb-0">
                            <div class="alert alert-warning d-flex align-items-center" role="alert">
                                <div class="container justify-content-center text-center">INFORMAÇÕES DO ANÚNCIO </div>
                            </div>
                        </div>
                
                        <table class="table table-striped table-hover align-middle" style="border-radius: 5px !important;">
                            <thead class="table-dark" style="border-radius: 5px !important;">
                                <tr style="border-radius: 5px !important;">
                                <th scope="col">#</th>
                                <th scope="col">Título</th>
                                <th scope="col">Designação</th>
                                <th scope="col" class="text-center">Data</th>
                                <th scope="col" class="text-center"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for property in properties %}
                                <tr>
                                    <th scope="row">{{ forloop.counter }}</th>
                                    <td>{{ property.titulo|truncatechars:30 }}</td>
                                    <td style="width: 120px;">{{ property.designacao.descricao }}</td>
                                    <td style="width: 100px;">{{ property.created_at |date:"d-m-Y"}}</td>
                                    <td class="text-center" style="width: 150px;">
                                    <!-- Edit -->
                                    <a href="#" 
                                        class="me-2 edit-property" 
                                        title="Editar" 
                                        style="text-decoration: none;"
                                        data-id="{{ property.id }}"
                                        data-titulo="{{ property.titulo }}"
                                        data-endereco="{{ property.endereco }}"
                                        data-descricao="{{ property.descricao }}"
                                        data-preco="{{ property.preco }}"
                                        data-pais="{{ property.pais.pais_id }}"
                                        data-cidade="{{ property.cidade.cidade_id }}"
                                        data-designacao="{{ property.designacao.id }}"
                                        data-fotos="{{ property.fotos.url }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#173660"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>
                                    </a>
                                    <!-- photo -->
                                    <a href="#" 
                                        class="me-2" title="Editar" 
                                        style="text-decoration: none;" 
                                        title="Adicionar imagens" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#addImagesModal"
                                        data-foto="{{ property.fotos.url }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="#173660"><path d="M0 0h24v24H0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                    </a>
                                    <!-- View -->
                                    <a href="#" 
                                        class="me-2" 
                                        title="Ver detalhes" 
                                        style="text-decoration: none;" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#detalhesModal"
                                        data-titulo="{{ property.titulo }}"
                                        data-endereco="{{ property.endereco }}"
                                        data-cidade="{{ property.cidade.nome }}"
                                        data-pais="{{ property.pais.nome }}"
                                        data-paisid="{{ property.pais.pais_id }}"
                                        data-preco="{{ property.preco }}"
                                        data-descricao="{{ property.descricao }}"
                                        data-designacao="{{ property.designacao.descricao }}"
                                        data-data_create = "{{property.created_at |date:"d-m-Y h:m:s" }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#173660"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640H447l-80-80H160v480l96-320h684L837-217q-8 26-29.5 41.5T760-160H160Zm84-80h516l72-240H316l-72 240Zm0 0 72-240-72 240Zm-84-400v-80 80Z"/></svg>
                                    </a>
                                    <!-- Delete -->
                                    <a href="{% url 'delete_property' property.id %}" title="Apagar" style="text-decoration: none;" onclick="return confirm('Tem certeza que deseja eliminar este anúncio?');">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#ff4200"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
                                    </a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="12" class="text-center text-muted">Nenhum anúncio encontrado</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <div class="col-12">
                            <input type="submit" id="btnNovo" onclick="accaoTabela()" value="Novo" class="btn btn-detalhes" />
                        </div>
                    </div>

                    <div class="caixa-detalhes" id="mobileDetalhes">
                        <div class="col-12">
                            <input type="submit" id="btnNovo" onclick="accaoMobile()" value="Novo" class="btn btn-detalhes" />
                        </div>
                        {% for property in properties %}
                            <div class="card" style="width: 100%; margin-top: 15px;">
                                <div class="card-header alert-warning"> INFORMAÇÕES DO ANÚNCIO </div>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item">
                                            <span class="fw-bold me-1">Titulo : </span> {{ property.titulo }}
                                        </li>
                                        <li class="list-group-item">
                                            <span class="fw-bold me-1">Designação : </span> {{ property.designacao.descricao }}
                                        </li>
                                        <li class="list-group-item">
                                            <span class="fw-bold me-1">Data : </span> {{ property.created_at |date:"d-m-Y" }}
                                        </li>
                                    </ul>
                                    <div class="card-footer" style="padding: 4px; text-align: center;">
                                        <!-- Edit -->
                                        <a href="#" 
                                            class="me-2 btn btn-secondary edit-property" 
                                            title="Editar" 
                                            style="text-decoration: none; width: 23% !important; height: 25px;height: 28px; padding: 0px !important;margin-right: 0px !important;"
                                            data-id="{{ property.id }}"
                                            data-titulo="{{ property.titulo }}"
                                            data-endereco="{{ property.endereco }}"
                                            data-descricao="{{ property.descricao }}"
                                            data-preco="{{ property.preco }}"
                                            data-pais="{{ property.pais.pais_id }}"
                                            data-cidade="{{ property.cidade.cidade_id }}"
                                            data-designacao="{{ property.designacao.id }}"
                                            data-fotos="{{ property.fotos.url }}">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#fff"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>
                                        </a>
                                        <!-- photo -->
                                        <a href="#" 
                                            class="me-2 btn btn-secondary" 
                                            title="Editar" 
                                            style="text-decoration: none; width: 23% !important;height: 25px;height: 28px; padding: 0px !important;margin-right: 0px !important;" 
                                            title="Adicionar imagens" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#addImagesModal"
                                            data-foto="{{ property.fotos.url }}">
                                            <!--<svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#fff"><path d="M440-440ZM120-120q-33 0-56.5-23.5T40-200v-480q0-33 23.5-56.5T120-760h126l74-80h240v80H355l-73 80H120v480h640v-360h80v360q0 33-23.5 56.5T760-120H120Zm640-560v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM440-260q75 0 127.5-52.5T620-440q0-75-52.5-127.5T440-620q-75 0-127.5 52.5T260-440q0 75 52.5 127.5T440-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29Z"/></svg>-->
                                            <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="#fff"><path d="M0 0h24v24H0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                        </a>
                                        <!-- View -->
                                        <a href="#" 
                                            class="me-2 btn btn-secondary" 
                                            title="Ver detalhes" 
                                            style="text-decoration: none; width: 23% !important;height: 25px;height: 28px; padding: 0px !important;margin-right: 0px !important;" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#detalhesModal"
                                            data-titulo="{{ property.titulo }}"
                                            data-endereco="{{ property.endereco }}"
                                            data-cidade="{{ property.cidade.nome }}"
                                            data-pais="{{ property.pais.nome }}"
                                            data-paisid="{{ property.pais.pais_id }}"
                                            data-preco="{{ property.preco }}"
                                            data-descricao="{{ property.descricao|escapejs }}"
                                            data-designacao="{{ property.designacao.descricao }}"
                                            data-data_create = "{{property.created_at |date:"d-m-Y h:m:s" }}">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#fff"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640H447l-80-80H160v480l96-320h684L837-217q-8 26-29.5 41.5T760-160H160Zm84-80h516l72-240H316l-72 240Zm0 0 72-240-72 240Zm-84-400v-80 80Z"/></svg>
                                        </a>
                                        <!-- Delete -->
                                        <a href="{% url 'delete_property' property.id %}" class="me-2 btn btn-secondary" title="Ver detalhes" style="text-decoration: none; width: 23% !important;height: 28px; padding: 0px !important;margin-right: 0px !important;" onclick="return confirm('Tem certeza que deseja eliminar este anúncio?');">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#fff"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
                                        </a>
                                    </div>
                                </div>
                            {% empty %}
                                <div class="alert alert-warning" style="margin-top: 15px;"> Não existem anúncios disponíveis. </div>
                            {% endfor %}
                            <br/>
                            <div class="col-12" id="novoTelefone">
                                <input type="submit" id="btnNovo" onclick="accaoMobile()" value="Novo" class="btn btn-detalhes" />
                            </div>
                        </div>
                    </div>
                </div>          
            </div>
        </div>
    </div>

    <!--Listar Modal-->
    <div class="modal fade" id="detalhesModal" tabindex="-1" aria-labelledby="detalhesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detalhesModalLabel">Detalhes do Anúncio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group list-group-numbered">
                        <li class="list-group-item list-group-item-primary">
                            <span class="fw-bold me-1">Titulo : </span> <span id="modal-titulo"></span>
                        </li>
                        <li class="list-group-item list-group-item-secondary">
                            <span class="fw-bold me-1">Designação : </span> 
                            <span id="modal-designacao"></span>
                        </li>
                        <li class="list-group-item list-group-item-primary">
                            <span class="fw-bold me-1">Endereço : </span> <span id="modal-endereco"></span>
                        </li>
                        <li class="list-group-item list-group-item-secondary">
                            <span class="fw-bold me-1">Local : </span> <span id="modal-local"></span>
                        </li>
                        <li class="list-group-item list-group-item-primary">
                            <span class="fw-bold me-1">Preço : </span> 
                            <span id="modal-preco" style="color: green; font-weight: bolder;"></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-start list-group-item-secondary">
                            <div class="ms-2 me-auto">
                            <div class="fw-bold">Descrição</div>
                            <span id="modal-descricao"></span>
                            </div>
                        </li>
                        <li class="list-group-item list-group-item-primary">
                            <span class="fw-bold me-1">Data : </span> <span id="modal-data"></span>                    
                        </li>   
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!--Adicionar mais imagens-->
    <div class="modal fade" id="addImagesModal" tabindex="-1" aria-labelledby="addImagesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
        
                <div class="modal-header">
                    <h5 class="modal-title" id="addImagesModalLabel">Imagem Principal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
        
                <div class="modal-body text-center">        
                    <img id="modal-foto" src="" alt="Imagem do anúncio" class="img-fluid rounded shadow">
                </div>
            
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

<script>

    window.onload = function() 
    {
        const btnOpenTable = document.getElementById("btnOpenTable");
        btnOpenTable.style.backgroundColor = "#ff6600";
    };

    function accaoTabela() 
    { 
        const caixaDetalhes = document.getElementById("caixa-detalhes");
        const formView = document.getElementById("formImovel"); 
        const btnOpenTable = document.getElementById("btnOpenTable");
        const previewFoto = document.getElementById("preview-foto");

        formView.style.display = "block";   
        caixaDetalhes.style.display = "none";
        btnOpenTable.style.backgroundColor = "#6c757d"; 
        previewFoto.style.display = "none";
    }

    function accaoMobile() 
    { 
        const caixaDetalhes = document.getElementById("mobileDetalhes");
        const formView = document.getElementById("formImovel"); 
        const btnOpenMobile = document.getElementById("btnOpenMobile");
        const previewFoto = document.getElementById("preview-foto");

        formView.style.display = "block";   
        caixaDetalhes.style.display = "none"; 
        btnOpenMobile.style.backgroundColor = "#6c757d";
        previewFoto.style.display = "none";
    }

    function openTable()
    {
        const caixaDetalhes = document.getElementById("caixa-detalhes");
        const formView = document.getElementById("formImovel"); 
        const btnOpenTable = document.getElementById("btnOpenTable");

        formView.style.display = "none";   
        caixaDetalhes.style.display = "block";
        btnOpenTable.style.backgroundColor = "#ff6600";
        btnOpenMobile.style.borderColor = "#f5ae7f";
    }

    function openMobile()
    {
        const caixaDetalhes = document.getElementById("mobileDetalhes");
        const formView = document.getElementById("formImovel"); 
        const btnOpenMobile = document.getElementById("btnOpenMobile");

        formView.style.display = "none";   
        caixaDetalhes.style.display = "block"; 
        btnOpenMobile.style.backgroundColor = "#ff6600";
        btnOpenMobile.style.borderColor = "#f5ae7f";
    }

    /*Tracking Number e formating money*/
    document.getElementById("preco").addEventListener("input", function (e) {
        // remove non-numeric characters
        this.value = this.value.replace(/[^0-9]/g, "");

        // check if value is <= 0
        if (this.value !== "" && parseInt(this.value) <= 0) {
            this.value = ""; // clear invalid input
            alert("O preço deve ser maior que zero.");
        }
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('detalhesModal');

    modal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;

        // Receber dados do botão
        const titulo = button.getAttribute('data-titulo');
        const endereco = button.getAttribute('data-endereco');
        const cidade = button.getAttribute('data-cidade');
        const pais = button.getAttribute('data-pais');
        const paisid = button.getAttribute('data-paisid');
        const preco = button.getAttribute('data-preco');
        const descricao = button.getAttribute('data-descricao');
        const designacao = button.getAttribute('data-designacao');
        const data_create = button.getAttribute('data-data_create');

        // Preencher o modal
        document.getElementById('modal-titulo').textContent = titulo;
        document.getElementById('modal-endereco').textContent = endereco;
        document.getElementById('modal-local').textContent = cidade + ", " + pais;

        // Moeda
        const precoFormatado = Number(preco).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
        const moeda = paisid == "1" ? "€ " : "AO ";
        document.getElementById('modal-preco').textContent = moeda + precoFormatado;

        // Descrição com enters
        document.getElementById('modal-descricao').innerHTML = descricao.replace(/\n/g, '<br>');

        document.getElementById('modal-designacao').textContent = designacao;
        document.getElementById('modal-data').textContent = data_create;
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('addImagesModal');

    modal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;

        // Receber o caminho da imagem
        const foto = button.getAttribute('data-foto');

        // Preencher o modal
        const img = document.getElementById('modal-foto');

        if (foto && foto !== "") {
            img.src = foto;
        } else {
            img.src = "https://via.placeholder.com/600x400?text=Sem+Imagem";
        }
    });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.edit-property').forEach(btn => {
        btn.addEventListener('click', function (e) {
            e.preventDefault();

            // Show the form instead of the table
            accaoTabela();
            accaoMobile();

            // Hidden ID for update
            document.getElementById('property_id').value = this.dataset.id || "";

            // Text inputs
            const titulo = document.querySelector('input[name="titulo"]');
            if (titulo) titulo.value = this.dataset.titulo || "";

            const endereco = document.querySelector('textarea[name="endereco"]');
            if (endereco) endereco.value = this.dataset.endereco || "";

            const descricao = document.querySelector('textarea[name="descricao"]');
            if (descricao) descricao.value = this.dataset.descricao || "";

            const preco = document.querySelector('input[name="preco"]');
            if (preco) preco.value = this.dataset.preco || "";

            // Selects
            const cidade = document.querySelector('select[name="cidade"]');
            if (cidade) cidade.value = this.dataset.cidade || "";

            const designacao = document.querySelector('select[name="designacao"]');
            if (designacao) designacao.value = this.dataset.designacao || "";

            // Radios (pais)
            document.querySelectorAll('input[name="pais"]').forEach(r => {
                r.checked = (r.value === String(this.dataset.pais));
            });

            // Preview image (cannot set file input directly)
            const preview = document.getElementById('preview-foto');
            if (preview) {
                preview.src = this.dataset.fotos || "https://via.placeholder.com/300x200?text=Sem+Imagem";
            }

            // Change submit button text
            const submitBtn = document.querySelector('input[type="submit"]');
            if (submitBtn) submitBtn.value = "Atualizar";

            const previewFoto = document.getElementById("preview-foto");
            previewFoto.style.display = "block";
        });
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const paisRadios = document.querySelectorAll('input[name="pais"]');
    const cidadeSelect = document.querySelector('select[name="cidade"]');

    function filtrarCidades(paisId) {
        // percorre todas as opções
        Array.from(cidadeSelect.options).forEach(opt => {
            if (!opt.value) return; // ignora "Selecione a cidade"
            opt.style.display = (opt.dataset.pais === paisId) ? 'block' : 'none';
        });

        // resetar seleção
        cidadeSelect.value = "";
    }

    // inicializar com o país selecionado
    const checkedPais = document.querySelector('input[name="pais"]:checked');
    if (checkedPais) filtrarCidades(checkedPais.value);

    // quando mudar o país
    paisRadios.forEach(radio => {
        radio.addEventListener('change', function () {
            filtrarCidades(this.value);
        });
    });
});
</script>








{% endblock %}

